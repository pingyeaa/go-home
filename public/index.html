<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpeg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.jpeg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"120.76.128.139","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ç©·ä¸å¤±å¿—ï¼Œå¯Œä¸ç™«ç‹‚">
<meta property="og:type" content="website">
<meta property="og:title" content="å¹³ä¹Ÿ">
<meta property="og:url" content="http://120.76.128.139/index.html">
<meta property="og:site_name" content="å¹³ä¹Ÿ">
<meta property="og:description" content="ç©·ä¸å¤±å¿—ï¼Œå¯Œä¸ç™«ç‹‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="å¹³ä¹Ÿ">
<meta property="article:tag" content="Go">
<meta property="article:tag" content="Golang">
<meta property="article:tag" content="é¢è¯•">
<meta property="article:tag" content="æ•™ç¨‹">
<meta property="article:tag" content="æŠ€æœ¯åŸç†">
<meta property="article:tag" content="å¤§å‚">
<meta property="article:tag" content="Gohper">
<meta property="article:tag" content="Go Home">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://120.76.128.139/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>å¹³ä¹Ÿ</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?85a08870520f980df35060aa2fc38c07";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">å¹³ä¹Ÿ</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä¸“æ³¨æŠ€æœ¯åŸç†ä¸Goè¯­è¨€</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>ç«™ç‚¹åœ°å›¾</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/pingyeaa/go-home" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://120.76.128.139/2020/04/22/other/github-webhooks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="å¹³ä¹Ÿ">
      <meta itemprop="description" content="ç©·ä¸å¤±å¿—ï¼Œå¯Œä¸ç™«ç‹‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¹³ä¹Ÿ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/22/other/github-webhooks/" class="post-title-link" itemprop="url">å¦‚ä½•ç”¨Githubé’©å­åšè‡ªåŠ¨éƒ¨ç½²</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-04-22 10:27:34 / ä¿®æ”¹æ—¶é—´ï¼š20:22:51" itemprop="dateCreated datePublished" datetime="2020-04-22T10:27:34+08:00">2020-04-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">æ‚è°ˆ</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2020/04/22/other/github-webhooks/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/22/other/github-webhooks/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>æœ€è¿‘æœºç¼˜å·§åˆçš„è´­ç½®äº†åŸŸåå’ŒæœåŠ¡å™¨ï¼Œä¸ç”¨å®åœ¨æ˜¯æµªè´¹ï¼Œå†åŠ ä¸Šä¸€ç›´æ²¡æœ‰å±äºè‡ªå·±çš„ä¸ªäººç½‘ç«™ï¼Œæ‰€ä»¥æ‰“ç®—ç”¨hexoåœ¨æœåŠ¡å™¨ä¸Šç©ä¸€ä¸‹ï¼Œè¿™æ ·ä¹Ÿå°±ä¸ç”¨å†çº ç»“ç”¨Github pagesè¿˜æ˜¯Gitee pagesäº†ã€‚å½“ç„¶ï¼Œä»Šå¤©çš„ä¸»é¢˜å¹¶ä¸æ˜¯åšå®¢æ­å»ºï¼Œè€Œæ˜¯å¦‚ä½•åˆ©ç”¨Githubçš„é’©å­ï¼Œå°†åšå®¢ä»£ç éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚</p>
<p>æ¯•ç«ŸGithubçš„é’©å­å·²ç»å†å²æ‚ ä¹…äº†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå¼€æºé¡¹ç›®å¯ä»¥æ‹¿æ¥ç”¨ï¼Œæ‰€ä»¥æˆ‘å¹¶æ²¡æœ‰é€ è½®å­ï¼Œè€Œæ˜¯å»æ‰¾äº†5K starçš„å¼€æºGoé¡¹ç›®<code>webhook</code>ï¼Œè¿™ä¸ªå·¥å…·çš„ä½œç”¨æ˜¯æ¥æ”¶Githubä»“åº“çš„å˜åŠ¨é€šçŸ¥ï¼Œç„¶åè°ƒç”¨ä½ é…ç½®å¥½çš„shellè„šæœ¬ï¼Œè„šæœ¬å¯ä»¥å†™ä¸Šä»£ç æ‹‰å–çš„å‘½ä»¤æˆ–æ˜¯ç¼–è¯‘çš„æ“ä½œç­‰ï¼Œå…·ä½“æ ¹æ®ä¸ªäººéœ€æ±‚è€Œå®šã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒåªèµ·ç€æ‹‰é€šGithubä¸ä½ æœåŠ¡å™¨çš„ä½œç”¨ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587526481705.png" alt="file"></p>
<h3 id="webhookå·¥å…·å®‰è£…"><a href="#webhookå·¥å…·å®‰è£…" class="headerlink" title="webhookå·¥å…·å®‰è£…"></a>webhookå·¥å…·å®‰è£…</h3><p>å› ä¸ºwebhookæ˜¯Goè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥è¦å…ˆå®‰è£…Goè¯­è¨€ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y golang</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥ç”¨goå‘½ä»¤å®‰è£…webhookäº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/adnanh/webhook</span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤å®‰è£…ä½ç½®å¯ä»¥é€šè¿‡<code>go env</code>æŸ¥çœ‹ï¼ŒGOPATHå°±æ˜¯å‘½ä»¤å®‰è£…è·¯å¾„ï¼Œæ¯”å¦‚æˆ‘çš„å‘½ä»¤å°±å®‰è£…åœ¨/root/go/bin/webhookã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">go env</span><br><span class="line">...</span><br><span class="line">GOOS="linux"</span><br><span class="line">GOPATH="/root/go"</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿæˆssh-key"><a href="#ç”Ÿæˆssh-key" class="headerlink" title="ç”Ÿæˆssh key"></a>ç”Ÿæˆssh key</h3><p>åœ¨ç¼–å†™è„šæœ¬ä¹‹å‰ç¡®ä¿æœåŠ¡å™¨æœ‰æƒé™æ‹‰å–githubä»£ç ï¼Œå¦‚æœå·²ç»åšäº†é…ç½®å¯è·³è¿‡æœ¬èŠ‚å»çœ‹<a href="#éƒ¨ç½²è„šæœ¬ç¼–å†™">éƒ¨ç½²è„šæœ¬ç¼–å†™</a>ã€‚ssh keyæ˜¯ä»£ç æ‰˜ç®¡å¹³å°ï¼ˆgithubã€giteeã€codingã€gitlabç­‰ï¼‰é‰´åˆ«ä½ æ˜¯å¦æœ‰æƒæ‹‰å–ä»£ç çš„èº«ä»½æ ‡è¯†ï¼Œç”Ÿæˆåªéœ€ä¸€è¡Œå‘½ä»¤å’Œä¸€è·¯å›è½¦å°±è¡Œäº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line"></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:M6sCf/J/hOu3zLxMkFUVmv3iWIa30CfbxiWqmWCt1YE root@iZwz96y36tk2ecnykzituxZ</span><br><span class="line">The key's randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|            ..o. |</span><br><span class="line">|           . o   |</span><br><span class="line">|          . o    |</span><br><span class="line">|       . o .     |</span><br><span class="line">|      E S.  .    |</span><br><span class="line">|  .  . ..Oo ..   |</span><br><span class="line">|   oo o ==Boo .  |</span><br><span class="line">|   .++.+o#== .   |</span><br><span class="line">|    .=*+=+@o     |</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆåå¯é€šè¿‡<code>cat ~/.ssh/id_rsa.pub</code>å‘½ä»¤æŸ¥çœ‹ï¼Œæœ€åå°†keyåŠ å…¥githubå³å¯ï¼ŒåŠ æ³•ä¸å†èµ˜è¿°ï¼Œè¯·è‡ªè¡Œè°·æ­Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub</span><br><span class="line"></span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQHBAAABAQCv7LGVJUFdcLL+HZyRFTQIQCdre61Gch76lDVpmWSX9BGGRU3iQS7EU5qApFn1VSvt+yf4rMt2LEkuxGCm1wIyBKZ6LYDViZBeTAfx4BcM1mcpxOX6I/+r07mQ4llTz+poQB1Zp9Y60uk0tbGOVWlCoDBEvf9qeEnQ0qEczEkv7wcawV6pVhlXjFKZgq0EOQbCYoWMvPUl+dwDbTcl/h+7At1nlgfF7IuRHlKf18qvgnTRT2wpiuz4pWdoAi8LcY1JiR1z5OB0oCJ2euhyDND39G2NxZRS1FIVdgCEvioHtdoHOSoWBlcSj0fLFSnscBfRBrCd7yhOP7fFKfrowHMj root@iZwz96y36tk2ecnykzituxZ</span><br></pre></td></tr></table></figure>

<h3 id="éƒ¨ç½²è„šæœ¬ç¼–å†™"><a href="#éƒ¨ç½²è„šæœ¬ç¼–å†™" class="headerlink" title="éƒ¨ç½²è„šæœ¬ç¼–å†™"></a>éƒ¨ç½²è„šæœ¬ç¼–å†™</h3><p>è¯¥shellè„šæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ä»githubæ‹‰å–ä»£ç ï¼Œè„šæœ¬å†…å®¹å¾ˆç®€å•ï¼Œåªåšäº†ç›®å½•çš„ç®€è¦åˆ¤æ–­ï¼Œä»£ç ç›®å½•å­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™å…‹éš†ä»“åº“ï¼Œå·¥ä½œç›®å½•å’Œä»“åº“åç§°ã€åœ°å€è¯·æ¢æˆè‡ªå·±çš„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cd /home/www/website</span><br><span class="line"></span><br><span class="line">if [ ! -d "go-home" ]; then</span><br><span class="line">  git clone https://github.com/pingyeaa/go-home.git</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cd go-home</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure>

<h3 id="webhooké…ç½®ä¸å¯åŠ¨"><a href="#webhooké…ç½®ä¸å¯åŠ¨" class="headerlink" title="webhooké…ç½®ä¸å¯åŠ¨"></a>webhooké…ç½®ä¸å¯åŠ¨</h3><p>ç¼–å†™é…ç½®æ–‡ä»¶hooks.jsonï¼Œæ ¼å¼å¦‚ä¸‹ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="string">"deploy-webhook"</span>,</span><br><span class="line">    <span class="attr">"execute-command"</span>: <span class="string">"deploy.sh"</span>,</span><br><span class="line">    <span class="attr">"command-working-directory"</span>: <span class="string">"/home"</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>idï¼šé’©å­çš„idï¼Œå¯è‡ªå®šä¹‰</li>
<li>execute-commandï¼šè¦æ‰§è¡Œçš„è„šæœ¬åï¼Œå°±æ˜¯åˆšæ‰ç¼–å†™çš„éƒ¨ç½²è„šæœ¬</li>
<li>command-working-directoryï¼šè„šæœ¬æ‰€åœ¨ç›®å½•</li>
</ul>
<p>å®Œæˆåé€šè¿‡webhookå‘½ä»¤å¯åŠ¨ï¼Œå¯ä»¥çœ‹åˆ°idä¸ºdeploy-webhookçš„é…ç½®å·²ç»åŠ è½½äº†ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ç›‘å¬çš„ç«¯å£å’Œè·¯å¾„ï¼Œç­‰ä¸‹è¦ç”¨åˆ°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/root/go/bin/webhook -hooks hooks.json -verbose</span><br><span class="line"></span><br><span class="line">[webhook] 2020/04/22 15:18:22 version 2.6.11 starting</span><br><span class="line">[webhook] 2020/04/22 15:18:22 setting up os signal watcher</span><br><span class="line">[webhook] 2020/04/22 15:18:22 attempting to load hooks from hooks.json</span><br><span class="line">[webhook] 2020/04/22 15:18:22 found 1 hook(s) in file</span><br><span class="line">[webhook] 2020/04/22 15:18:22   loaded: deploy-webhook</span><br><span class="line">[webhook] 2020/04/22 15:18:22 serving hooks on http://0.0.0.0:9000/hooks/&#123;id&#125;</span><br><span class="line">[webhook] 2020/04/22 15:18:22 os signal watcher ready</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0.0.0.0:9000/hooks/&#123;id&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Github-Webhooksé…ç½®"><a href="#Github-Webhooksé…ç½®" class="headerlink" title="Github Webhooksé…ç½®"></a>Github Webhooksé…ç½®</h3><p>ç°åœ¨æœåŠ¡å™¨å·²ç»å¯åŠ¨äº†webhookç¨‹åºç›‘å¬9000ç«¯å£ï¼Œæ¥ä¸‹æ¥ä»…éœ€è¦å‘Šè¯‰Githubè¿™ä¸ªåœ°å€å’Œç«¯å£å°±å¥½äº†ã€‚</p>
<p>æ‰“å¼€ä»“åº“è®¾ç½®é¡µï¼Œæ·»åŠ webhookã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587523289550.png" alt=""></p>
<p>é…ç½®webhooksï¼ŒPayload URLå°±æ˜¯è¦é€šçŸ¥çš„åœ°å€ï¼ŒæŠŠåˆšæ‰æ‰“å°å‡ºçš„ç«¯å£å’Œè·¯å¾„å¡«ä¸Šå³å¯ï¼Œå…¶ä»–é»˜è®¤ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587541102651.png" alt="file"></p>
<p>ç°åœ¨å¯ä»¥æäº¤ä»£ç æµ‹è¯•äº†ï¼Œå¦‚æœæ¨é€å¤±è´¥Githubä¸­ä¼šæœ‰é”™è¯¯æç¤ºï¼ŒåŒæ ·çš„ï¼ŒæˆåŠŸä¸ä»…åœ¨Githubä¸­èƒ½çœ‹åˆ°ï¼ŒæœåŠ¡å™¨çš„æ‰“å°æ—¥å¿—ä¹Ÿæœ‰è®°å½•ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587541394355.png" alt="file"></p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587541482026.png" alt="file"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://120.76.128.139/2020/04/21/golang/gpm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="å¹³ä¹Ÿ">
      <meta itemprop="description" content="ç©·ä¸å¤±å¿—ï¼Œå¯Œä¸ç™«ç‹‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¹³ä¹Ÿ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/21/golang/gpm/" class="post-title-link" itemprop="url">Golangçš„GPMæ¨¡å‹æ˜¯ä»€ä¹ˆï¼Ÿ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-04-21 19:19:34" itemprop="dateCreated datePublished" datetime="2020-04-21T19:19:34+08:00">2020-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-04-22 20:15:46" itemprop="dateModified" datetime="2020-04-22T20:15:46+08:00">2020-04-22</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2020/04/21/golang/gpm/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/21/golang/gpm/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>ğŸ˜‹æˆ‘æ˜¯å¹³ä¹Ÿï¼Œè¿™æœ‰ä¸€ä¸ªä¸“æ³¨GopheræŠ€æœ¯æˆé•¿çš„å¼€æºé¡¹ç›®<a href="https://github.com/pingyeaa/go-home" target="_blank" rel="noopener">ã€Œgo homeã€</a></p>
</blockquote>
<h2 id="å¯¼è¯»"><a href="#å¯¼è¯»" class="headerlink" title="å¯¼è¯»"></a>å¯¼è¯»</h2><p>ç›¸ä¿¡å¾ˆå¤šäººéƒ½å¬è¯´è¿‡Goè¯­è¨€å¤©ç„¶æ”¯æŒé«˜å¹¶å‘ï¼ŒåŸå› æ˜¯å†…éƒ¨æœ‰åç¨‹ï¼ˆgoroutineï¼‰åŠ æŒï¼Œå¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å¯åŠ¨æˆåƒä¸Šä¸‡ä¸ªåç¨‹ã€‚é‚£ä¹ˆï¼Œå®ƒå‡­ä»€ä¹ˆåšåˆ°å¦‚æ­¤é«˜çš„å¹¶å‘å‘¢ï¼Ÿé‚£å°±éœ€è¦å…ˆäº†è§£ä»€ä¹ˆæ˜¯å¹¶å‘æ¨¡å‹ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1586933074098.png" alt="file"></p>
<h2 id="å¹¶å‘æ¨¡å‹"><a href="#å¹¶å‘æ¨¡å‹" class="headerlink" title="å¹¶å‘æ¨¡å‹"></a>å¹¶å‘æ¨¡å‹</h2><p>è‘—åçš„C++ä¸“å®¶Herb Sutteræ›¾ç»è¯´è¿‡â€œå…è´¹çš„åˆé¤å·²ç»ç»ˆç»“â€ã€‚ä¸ºäº†è®©ä»£ç è¿è¡Œçš„æ›´å¿«ï¼Œå•çº¯ä¾é æ›´å¿«çš„ç¡¬ä»¶å·²ç»æ— æ³•å¾—åˆ°æ»¡è¶³ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨å¤šæ ¸æ¥æŒ–æ˜å¹¶è¡Œçš„ä»·å€¼ï¼Œè€Œå¹¶å‘æ¨¡å‹çš„ç›®çš„å°±æ˜¯æ¥å‘Šè¯‰ä½ ä¸åŒæ‰§è¡Œå®ä½“ä¹‹é—´æ˜¯å¦‚ä½•åä½œçš„ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1586933150449.png" alt="file"></p>
<p>å½“ç„¶ï¼Œä¸åŒçš„å¹¶å‘æ¨¡å‹çš„åä½œæ–¹å¼ä¹Ÿä¸å°½ç›¸åŒï¼Œå¸¸è§çš„å¹¶å‘æ¨¡å‹æœ‰ä¸ƒç§ï¼š</p>
<ul>
<li>çº¿ç¨‹ä¸é”</li>
<li>å‡½æ•°å¼ç¼–ç¨‹</li>
<li>Clojureä¹‹é“</li>
<li>actor</li>
<li>é€šè®¯é¡ºåºè¿›ç¨‹ï¼ˆCSPï¼‰</li>
<li>æ•°æ®çº§å¹¶è¡Œ</li>
<li>Lambdaæ¶æ„</li>
</ul>
<p>è€Œä»Šå¤©ï¼Œæˆ‘ä»¬åªè®²ä¸Goè¯­è¨€ç›¸å…³çš„å¹¶å‘æ¨¡å‹CSPï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ä¹¦ç±ã€Šä¸ƒå‘¨ä¸ƒå¹¶å‘æ¨¡å‹ã€‹ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1586933889538.png" alt="file"></p>
<h2 id="CSPç¯‡"><a href="#CSPç¯‡" class="headerlink" title="CSPç¯‡"></a>CSPç¯‡</h2><p>CSPï¼Œå…¨ç§°Communicating Sequential Processesï¼Œæ„ä¸ºé€šè®¯é¡ºåºè¿›ç¨‹ï¼Œå®ƒæ˜¯ä¸ƒå¤§å¹¶å‘æ¨¡å‹ä¸­çš„ä¸€ç§ï¼Œå®ƒçš„æ ¸å¿ƒè§‚å¿µæ˜¯å°†ä¸¤ä¸ªå¹¶å‘æ‰§è¡Œçš„å®ä½“é€šè¿‡é€šé“channelè¿æ¥èµ·æ¥ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½é€šè¿‡channelä¼ è¾“ã€‚å…¶å®CSPæ¦‚å¿µæ—©åœ¨1978å¹´å°±è¢«<a href="#ä¸œå°¼Â·éœå°”">ä¸œå°¼Â·éœå°”</a>æå‡ºï¼Œç”±äºè¿‘æ¥Goè¯­è¨€çš„å…´èµ·ï¼ŒCSPåˆç«äº†èµ·æ¥ã€‚</p>
<p>é‚£ä¹ˆCSPä¸Goè¯­è¨€æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹Goè¯­è¨€å¯¹CSPå¹¶å‘æ¨¡å‹çš„å®ç°â€”â€”GPMè°ƒåº¦æ¨¡å‹ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1586936057139.png" alt="file"></p>
<h2 id="GPMè°ƒåº¦æ¨¡å‹"><a href="#GPMè°ƒåº¦æ¨¡å‹" class="headerlink" title="GPMè°ƒåº¦æ¨¡å‹"></a>GPMè°ƒåº¦æ¨¡å‹</h2><p>GPMä»£è¡¨äº†ä¸‰ä¸ªè§’è‰²ï¼Œåˆ†åˆ«æ˜¯Goroutineã€Processorã€Machineã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587000414117.png" alt="file"></p>
<ul>
<li>Goroutineï¼šå°±æ˜¯å’±ä»¬å¸¸ç”¨çš„ç”¨goå…³é”®å­—åˆ›å»ºçš„æ‰§è¡Œä½“ï¼Œå®ƒå¯¹åº”ä¸€ä¸ªç»“æ„ä½“gï¼Œç»“æ„ä½“é‡Œä¿å­˜äº†goroutineçš„å †æ ˆä¿¡æ¯</li>
<li>Machineï¼šè¡¨ç¤ºæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹</li>
<li>Processorï¼šè¡¨ç¤ºå¤„ç†å™¨ï¼Œæœ‰äº†å®ƒæ‰èƒ½å»ºç«‹Gã€Mçš„è”ç³»</li>
</ul>
<h3 id="Goroutine"><a href="#Goroutine" class="headerlink" title="Goroutine"></a>Goroutine</h3><p>Goroutineå°±æ˜¯ä»£ç ä¸­ä½¿ç”¨goå…³é”®è¯åˆ›å»ºçš„æ‰§è¡Œå•å…ƒï¼Œä¹Ÿæ˜¯å¤§å®¶ç†ŸçŸ¥çš„æœ‰â€œè½»é‡çº§çº¿ç¨‹â€ä¹‹ç§°çš„åç¨‹ï¼Œåç¨‹æ˜¯ä¸ä¸ºæ“ä½œç³»ç»Ÿæ‰€çŸ¥çš„ï¼Œå®ƒç”±ç¼–ç¨‹è¯­è¨€å±‚é¢å®ç°ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ä¸éœ€è¦ç»è¿‡å†…æ ¸æ€ï¼Œå†åŠ ä¸Šåç¨‹å ç”¨çš„å†…å­˜ç©ºé—´æå°ï¼Œæ‰€ä»¥æœ‰ç€éå¸¸å¤§çš„å‘å±•æ½œåŠ›ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;&#125;()</span><br></pre></td></tr></table></figure>

<p>åœ¨Goè¯­è¨€ä¸­ï¼ŒGoroutineç”±ä¸€ä¸ªåä¸º<code>runtime.go</code>çš„ç»“æ„ä½“è¡¨ç¤ºï¼Œè¯¥ç»“æ„ä½“éå¸¸å¤æ‚ï¼Œæœ‰40å¤šä¸ªæˆå‘˜å˜é‡ï¼Œä¸»è¦å­˜å‚¨æ‰§è¡Œæ ˆã€çŠ¶æ€ã€å½“å‰å ç”¨çš„çº¿ç¨‹ã€è°ƒåº¦ç›¸å…³çš„æ•°æ®ã€‚è¿˜æœ‰ç©å¤§å®¶å¾ˆæƒ³è·å–çš„goroutineæ ‡è¯†ï¼Œä½†æ˜¯å¾ˆæŠ±æ­‰ï¼Œå®˜æ–¹è€ƒè™‘åˆ°Goè¯­è¨€çš„å‘å±•ï¼Œè®¾ç½®æˆç§æœ‰äº†ï¼Œä¸ç»™ä½ è°ƒç”¨ğŸ˜ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> g <span class="keyword">struct</span> &#123;</span><br><span class="line">	stack <span class="keyword">struct</span> &#123;</span><br><span class="line">		lo <span class="keyword">uintptr</span></span><br><span class="line">		hi <span class="keyword">uintptr</span></span><br><span class="line">	&#125; 							<span class="comment">// æ ˆå†…å­˜ï¼š[stack.lo, stack.hi)</span></span><br><span class="line">	stackguard0	<span class="keyword">uintptr</span></span><br><span class="line">	stackguard1 <span class="keyword">uintptr</span></span><br><span class="line"></span><br><span class="line">	_panic       *_panic</span><br><span class="line">	_defer       *_defer</span><br><span class="line">	m            *m				<span class="comment">// å½“å‰çš„ m</span></span><br><span class="line">	sched        gobuf</span><br><span class="line">	stktopsp     <span class="keyword">uintptr</span>		<span class="comment">// æœŸæœ› sp ä½äºæ ˆé¡¶ï¼Œç”¨äºå›æº¯æ£€æŸ¥</span></span><br><span class="line">	param        unsafe.Pointer <span class="comment">// wakeup å”¤é†’æ—¶å€™ä¼ é€’çš„å‚æ•°</span></span><br><span class="line">	atomicstatus <span class="keyword">uint32</span></span><br><span class="line">	goid         <span class="keyword">int64</span></span><br><span class="line">	preempt      <span class="keyword">bool</span>       	<span class="comment">// æŠ¢å ä¿¡å·ï¼Œstackguard0 = stackpreempt çš„å‰¯æœ¬</span></span><br><span class="line">	timer        *timer         <span class="comment">// ä¸º time.Sleep ç¼“å­˜çš„è®¡æ—¶å™¨</span></span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Goroutineè°ƒåº¦ç›¸å…³çš„æ•°æ®å­˜å‚¨åœ¨schedï¼Œåœ¨åç¨‹åˆ‡æ¢ã€æ¢å¤ä¸Šä¸‹æ–‡çš„æ—¶å€™ç”¨åˆ°ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> gobuf <span class="keyword">struct</span> &#123;</span><br><span class="line">	sp   <span class="keyword">uintptr</span></span><br><span class="line">	pc   <span class="keyword">uintptr</span></span><br><span class="line">	g    guintptr</span><br><span class="line">	ret  sys.Uintreg</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Machine"><a href="#Machine" class="headerlink" title="Machine"></a>Machine</h3><p>Må°±æ˜¯å¯¹åº”æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ï¼Œæœ€å¤šä¼šæœ‰GOMAXPROCSä¸ªæ´»è·ƒçº¿ç¨‹èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œé»˜è®¤æƒ…å†µä¸‹GOMAXPROCSè¢«è®¾ç½®ä¸ºå†…æ ¸æ•°ï¼Œå‡å¦‚æœ‰å››ä¸ªå†…æ ¸ï¼Œé‚£ä¹ˆé»˜è®¤å°±åˆ›å»ºå››ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªruntime.mç»“æ„ä½“ã€‚çº¿ç¨‹æ•°ç­‰äºCPUä¸ªæ•°çš„åŸå› æ˜¯ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ†é…åˆ°ä¸€ä¸ªCPUä¸Šå°±ä¸è‡³äºå‡ºç°çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯ä»¥ä¿è¯ç³»ç»Ÿå¼€é”€é™åˆ°æœ€ä½ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> m <span class="keyword">struct</span> &#123;</span><br><span class="line">	g0   *g </span><br><span class="line">	curg *g</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Mé‡Œé¢å­˜äº†ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯g0ï¼Œä¸€ä¸ªæ˜¯curgã€‚</p>
<ul>
<li>g0ï¼šä¼šæ·±åº¦å‚ä¸è¿è¡Œæ—¶çš„è°ƒåº¦è¿‡ç¨‹ï¼Œæ¯”å¦‚goroutineçš„åˆ›å»ºã€å†…å­˜åˆ†é…ç­‰</li>
<li>curgï¼šä»£è¡¨å½“å‰æ­£åœ¨çº¿ç¨‹ä¸Šæ‰§è¡Œçš„goroutineã€‚</li>
</ul>
<p>åˆšæ‰è¯´Pæ˜¯è´Ÿè´£Mä¸Gçš„å…³è”ï¼Œæ‰€ä»¥Mé‡Œé¢è¿˜è¦å­˜å‚¨ä¸Pç›¸å…³çš„æ•°æ®ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> m <span class="keyword">struct</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">	p             puintptr</span><br><span class="line">	nextp         puintptr</span><br><span class="line">	oldp          puintptr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>pï¼šæ­£åœ¨è¿è¡Œä»£ç çš„å¤„ç†å™¨</li>
<li>nextpï¼šæš‚å­˜çš„å¤„ç†å™¨</li>
<li>oldï¼šç³»ç»Ÿè°ƒç”¨ä¹‹å‰çš„çº¿ç¨‹çš„å¤„ç†å™¨</li>
</ul>
<h3 id="Processor"><a href="#Processor" class="headerlink" title="Processor"></a>Processor</h3><p>Proccessorè´Ÿè´£Machineä¸Goroutineçš„è¿æ¥ï¼Œå®ƒèƒ½æä¾›çº¿ç¨‹éœ€è¦çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¹Ÿèƒ½åˆ†é…Gåˆ°å®ƒåº”è¯¥å»çš„çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œæœ‰äº†å®ƒï¼Œæ¯ä¸ªGéƒ½èƒ½å¾—åˆ°åˆç†çš„è°ƒç”¨ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¸å†æµ‘æ°´æ‘¸é±¼ï¼ŒçœŸæ˜¯å±…å®¶å¿…å¤‡ä¹‹è‰¯å“ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587113752718.png" alt="file"></p>
<p>åŒæ ·çš„ï¼Œå¤„ç†å™¨çš„æ•°é‡ä¹Ÿæ˜¯é»˜è®¤æŒ‰ç…§GOMAXPROCSæ¥è®¾ç½®çš„ï¼Œä¸çº¿ç¨‹çš„æ•°é‡ä¸€ä¸€å¯¹åº”ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> p <span class="keyword">struct</span> &#123;</span><br><span class="line">	m           muintptr</span><br><span class="line"></span><br><span class="line">	runqhead <span class="keyword">uint32</span></span><br><span class="line">	runqtail <span class="keyword">uint32</span></span><br><span class="line">	runq     [<span class="number">256</span>]guintptr</span><br><span class="line">	runnext guintptr</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æ„ä½“Pä¸­å­˜å‚¨äº†æ€§èƒ½è¿½è¸ªã€åƒåœ¾å›æ”¶ã€è®¡æ—¶å™¨ç­‰ç›¸å…³çš„å­—æ®µå¤–ï¼Œè¿˜å­˜å‚¨äº†å¤„ç†å™¨çš„å¾…è¿è¡Œé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ˜¯å¾…æ‰§è¡Œçš„Goroutineåˆ—è¡¨ã€‚</p>
<h3 id="ä¸‰è€…çš„å…³ç³»"><a href="#ä¸‰è€…çš„å…³ç³»" class="headerlink" title="ä¸‰è€…çš„å…³ç³»"></a>ä¸‰è€…çš„å…³ç³»</h3><p>é¦–å…ˆï¼Œé»˜è®¤å¯åŠ¨å››ä¸ªçº¿ç¨‹å››ä¸ªå¤„ç†å™¨ï¼Œç„¶åäº’ç›¸ç»‘å®šã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587114801967.png" alt="file"></p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œä¸€ä¸ªGoroutineç»“æ„ä½“è¢«åˆ›å»ºï¼Œåœ¨è¿›è¡Œå‡½æ•°ä½“åœ°å€ã€å‚æ•°èµ·å§‹åœ°å€ã€å‚æ•°é•¿åº¦ç­‰ä¿¡æ¯ä»¥åŠè°ƒåº¦ç›¸å…³å±æ€§æ›´æ–°ä¹‹åï¼Œå®ƒå°±è¦è¿›åˆ°ä¸€ä¸ªå¤„ç†å™¨çš„é˜Ÿåˆ—ç­‰å¾…å‘è½¦ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587115359415.png" alt="file"></p>
<p>å•¥ï¼Œåˆåˆ›å»ºäº†ä¸€ä¸ªGï¼Ÿé‚£å°±è½®æµå¾€å…¶ä»–Pé‡Œé¢æ”¾å‘—ï¼Œç›¸ä¿¡ä½ æ’é˜Ÿå–å·çš„æ—¶å€™çœ‹åˆ°å…¶ä»–çª—å£æ²¡äººæ’é˜Ÿä¹Ÿä¼šè¿‡å»çš„ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587115552203.png" alt="file"></p>
<p>å‡å¦‚æœ‰å¾ˆå¤šGï¼Œéƒ½å¡æ»¡äº†æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±ä¸æŠŠGå¡åˆ°å¤„ç†å™¨çš„ç§æœ‰é˜Ÿåˆ—é‡Œäº†ï¼Œè€Œæ˜¯æŠŠå®ƒå¡åˆ°å…¨å±€é˜Ÿåˆ—é‡Œï¼ˆå€™è½¦å¤§å…ï¼‰ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587115783681.png" alt="file"></p>
<p>é™¤äº†å¾€é‡Œå¡ä¹‹å¤–ï¼ŒMè¿™è¾¹è¿˜è¦ç–¯ç‹‚å¾€å¤–å–ï¼Œé¦–å…ˆå»å¤„ç†å™¨çš„ç§æœ‰é˜Ÿåˆ—é‡Œå–Gæ‰§è¡Œï¼Œå¦‚æœå–å®Œçš„è¯å°±å»å…¨å±€é˜Ÿåˆ—å–ï¼Œå¦‚æœå…¨å±€é˜Ÿåˆ—é‡Œä¹Ÿæ²¡æœ‰çš„è¯ï¼Œå°±å»å…¶ä»–å¤„ç†å™¨é˜Ÿåˆ—é‡Œå·ï¼Œå“‡ï¼Œè¿™ä¹ˆé¥¥æ¸´ï¼Œç®€ç›´æ˜¯æ¶é­”å•Šï¼</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587116221683.png" alt="file"></p>
<p>å¦‚æœå“ªé‡Œéƒ½æ²¡æ‰¾åˆ°è¦æ‰§è¡Œçš„Gå‘¢ï¼Ÿé‚£Må°±ä¼šå› ä¸ºå¤ªå¤±æœ›å’ŒPæ–­å¼€å…³ç³»ï¼Œç„¶åå»ç¡è§‰ï¼ˆidleï¼‰äº†ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587116525502.png" alt="file"></p>
<p>é‚£å¦‚æœä¸¤ä¸ªGoroutineæ­£åœ¨é€šè¿‡channelåšä¸€äº›æ©æ©çˆ±çˆ±çš„äº‹é˜»å¡ä½äº†æ€ä¹ˆåŠï¼Œéš¾é“Mè¦ç­‰ä»–ä»¬å®Œäº‹äº†å†ç»§ç»­æ‰§è¡Œï¼Ÿæ˜¾ç„¶ä¸ä¼šï¼ŒMå¹¶ä¸ç¨€ç½•è¿™å¯¹Goç”·å¥³ï¼Œè€Œä¼šè½¬èº«å»æ‰¾åˆ«çš„Gæ‰§è¡Œã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587116986094.png" alt="file"></p>
<h3 id="ç³»ç»Ÿè°ƒç”¨"><a href="#ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨"></a>ç³»ç»Ÿè°ƒç”¨</h3><p>å¦‚æœGè¿›è¡Œäº†ç³»ç»Ÿè°ƒç”¨syscallï¼ŒMä¹Ÿä¼šè·Ÿç€è¿›å…¥ç³»ç»Ÿè°ƒç”¨çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªPç•™åœ¨è¿™é‡Œå°±æµªè´¹äº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ç‚¹ç²¾å¦™ä¹‹å¤„åœ¨äºï¼ŒPä¸ä¼šå‚»å‚»çš„ç­‰å¾…Gå’ŒMç³»ç»Ÿè°ƒç”¨å®Œæˆï¼Œè€Œä¼šå»æ‰¾å…¶ä»–æ¯”è¾ƒé—²çš„Mæ‰§è¡Œå…¶ä»–çš„Gã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587123545411.png" alt="file"></p>
<p>å½“Gå®Œæˆäº†ç³»ç»Ÿè°ƒç”¨ï¼Œå› ä¸ºè¦ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ‰€ä»¥å¿…é¡»è¦å†æ‰¾ä¸€ä¸ªç©ºé—²çš„å¤„ç†å™¨å‘è½¦ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587124060921.png" alt="file"></p>
<p>å¦‚æœæ²¡æœ‰ç©ºé—²çš„å¤„ç†å™¨äº†ï¼Œé‚£å°±åªèƒ½æŠŠGæ”¾å›å…¨å±€é˜Ÿåˆ—å½“ä¸­ç­‰å¾…åˆ†é…ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1587124627966.png" alt="file"></p>
<h3 id="sysmon"><a href="#sysmon" class="headerlink" title="sysmon"></a>sysmon</h3><p>sysmonæ˜¯æˆ‘ä»¬çš„ä¿æ´é˜¿å§¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªMï¼Œåˆå«ç›‘æ§çº¿ç¨‹ï¼Œä¸éœ€è¦På°±å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œæ¯20us~10msä¼šè¢«å”¤é†’ä¸€æ¬¡å‡ºæ¥æ‰“æ‰«å«ç”Ÿï¼Œä¸»è¦å·¥ä½œå°±æ˜¯å›æ”¶åƒåœ¾ã€å›æ”¶é•¿æ—¶é—´ç³»ç»Ÿè°ƒåº¦é˜»å¡çš„Pã€å‘é•¿æ—¶é—´è¿è¡Œçš„Gå‘å‡ºæŠ¢å è°ƒåº¦ç­‰ç­‰ã€‚</p>
<h2 id="è¯æ¡è§£é‡Š"><a href="#è¯æ¡è§£é‡Š" class="headerlink" title="è¯æ¡è§£é‡Š"></a>è¯æ¡è§£é‡Š</h2><h3 id="ä¸œå°¼Â·éœå°”"><a href="#ä¸œå°¼Â·éœå°”" class="headerlink" title="ä¸œå°¼Â·éœå°”"></a>ä¸œå°¼Â·éœå°”</h3><p>ä¸œå°¼Â·éœå°”ï¼Œè‹±å›½è®¡ç®—æœºç§‘å­¦å®¶ï¼Œå›¾çµå¥–å¾—ä¸»ï¼Œä»–è®¾è®¡äº†ç‰›æ°”å†²å¤©çš„å¿«é€Ÿæ’åºç®—æ³•ã€éœå°”é€»è¾‘ä»¥åŠCSPæ¨¡å‹ã€‚2011å¹´è·é¢çº¦ç¿°Â·å†¯è¯ºä¾æ›¼å¥–ã€‚</p>
<p><img src="http://pingyeaa.oss-cn-shenzhen.aliyuncs.com/image-1586934654476.png" alt="file"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="å¹³ä¹Ÿ"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">å¹³ä¹Ÿ</p>
  <div class="site-description" itemprop="description">ç©·ä¸å¤±å¿—ï¼Œå¯Œä¸ç™«ç‹‚</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/pingyeaa" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;pingyeaa" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:pingyeaa@163.com" title="E-Mail â†’ mailto:pingyeaa@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å¹³ä¹Ÿ</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> å¼ºåŠ›é©±åŠ¨
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'http://120.76.128.139/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'EnN1SqI0wowzmH5RgL6wyRln-gzGzoHsz',
      appKey     : 'TPxMO4X4Y6SjUYolSXdlWjs7',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-Hans' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
